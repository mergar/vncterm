#!/usr/local/bin/cbsd
#v10.3.0
MYARG="jname mode"
MYOPTARG="addr port command password"
MYDESC="Run VNC server for jail"
ADDHELP="mode=start, stop\n\
addr= IP address for listen, default - nodeip\n\
port= PORT for listen, default - 0 \(auto\)\n\
command= run comman on start, default: /bin/csh\n\
password= set password\n"

. ${subr}
. ${system}
. ${tools}
. ${strings}

init $*

. ${jrcconf}
[ $? -eq 1 ] && err 1 "${MAGENTA}No such jail: ${GREEN}${jname}${NORMAL}"
[ ${jid} -eq 0 ] && err 1 "${MAGENTA}Not running${NORMAL}"

cbsdvnc="${moduledir}/vncterm.d/cbsdvnc"

[ ! -x "${cbsdvnc}" ] && err 1 "${MAGENTA}No cbsdvnc, please do: ${GREEN}make -C ${moduledir}/vncterm.d${NORMAL}"

[ -z "${command}" ] && command="/bin/csh"

password_args=

if [ -n "${password}" ]; then
	password_args="-w ${password}"
fi

if [ -n "${port}" ]; then
	port_args="-p 0"
fi

if [ -n "${addr}" ]; then
	addr_args="-a 0.0.0.0"
fi

case "${mode}" in
	run)
		${cbsdvnc} -j ${jid} -s ${command} ${password_args} ${port_args} ${addr_args}
		;;
	stop)
		echo "STOP"
		exit 0
		${cbsdvnc} -j ${jid} -s ${command} ${password_args} ${port_args} ${addr_args}
		;;
	*)
		${ECHO} "${MAGENTA}Unknown mode. Use ${GREEN}start${MAGENTA} or ${GREEN}stop${NORMAL}"
		;;
esac
